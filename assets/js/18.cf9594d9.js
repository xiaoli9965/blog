(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{453:function(t,s,a){"use strict";a.r(s);var n=a(34),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"å…³é”®ç‚¹é€Ÿè®°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å…³é”®ç‚¹é€Ÿè®°"}},[t._v("#")]),t._v(" å…³é”®ç‚¹é€Ÿè®°")]),t._v(" "),a("ul",[a("li",[t._v("ä¸ä¼ å‚æ•°åˆ›å»º,é»˜è®¤åˆå§‹å®¹é‡16")]),t._v(" "),a("li",[t._v("åˆ›å»ºæ—¶æŒ‡å®šåˆå§‹å®¹é‡,å†…éƒ¨ä¼šè¿›è¡Œè®¡ç®—. æœ€ç»ˆçš„å€¼ä¼šæ¯”ä¼ å…¥çš„å¤§,æœ€ç»ˆç®—å‡ºæ¥çš„æ ‘ç»å¯¹æ˜¯2å¹‚æ¬¡æ–¹\n"),a("ul",[a("li",[t._v("tableSizeFor(initialCapacity + (initialCapacity >>> 1) + 1))")])])]),t._v(" "),a("li",[t._v("åˆ›å»ºæ—¶åˆå§‹å®¹é‡è®¡ç®—å®Œæ¯•åä¼šèµ‹å€¼ç»™"),a("code",[t._v("sizeCtl")]),t._v("å˜é‡")]),t._v(" "),a("li",[t._v("å¦‚æœæ•°ç»„é•¿åº¦å°äº64,å³ä½¿é“¾è¡¨é•¿åº¦è¾¾åˆ°8ä¹Ÿä¼šä¸ä¼šå˜æˆæ ‘,ä¼šèµ°æ•°ç»„æ‰©å®¹é€»è¾‘")])]),t._v(" "),a("h2",{attrs:{id:"å­˜å‚¨æ•°æ®çš„ç»“æ„"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å­˜å‚¨æ•°æ®çš„ç»“æ„"}},[t._v("#")]),t._v(" å­˜å‚¨æ•°æ®çš„ç»“æ„")]),t._v(" "),a("ul",[a("li",[t._v("å’Œæ™®é€šMapçš„ç»“æ„åŸºæœ¬ä¸€è‡´")]),t._v(" "),a("li",[a("code",[t._v("æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘")])]),t._v(" "),a("li",[t._v("å­˜å‚¨æ•°æ®çš„ç»“æ„æ˜¯ Nodeå¯¹è±¡, key,value, æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„nodeæŒ‡é’ˆ"),a("code",[t._v("next")]),t._v(" "),a("ul",[a("li",[t._v("nextçš„ä½œç”¨æ˜¯hashå†²çªä¹‹åç”Ÿæˆé“¾è¡¨ç”¨çš„")])])])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Entry")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" hash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),t._v(" val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"ğŸ’¥-sizectlå«ä¹‰-ç®€ç§°-sc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ’¥-sizectlå«ä¹‰-ç®€ç§°-sc"}},[t._v("#")]),t._v(" ğŸ’¥ SizeCtlå«ä¹‰ (ç®€ç§°:SC)")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("transient")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" sizeCtl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ol",[a("li",[t._v("sizeCtlä¸º0çš„æ—¶å€™,ä»£è¡¨æ•°æ®æœªåˆå§‹åŒ–,ä¸”æ•°ç»„çš„åˆå§‹åŒ–å®¹é‡ä¸º16")]),t._v(" "),a("li",[t._v("sizeCtlä¸ºæ­£æ•°, å¦‚æœæ•°æ®ç»„æœªåˆå§‹åŒ–,é‚£ä¹ˆè®°å½•çš„æ˜¯æ•°ç»„çš„åˆå§‹å®¹é‡,å¦‚æœæ•°ç»„å·²ç»åˆå§‹åŒ–,é‚£ä¹ˆå…¶è®°å½•çš„æ˜¯æ•°ç»„çš„æ‰©å®¹é˜ˆå€¼\n"),a("ol",[a("li",[t._v("é˜ˆå€¼è®¡ç®—æ–¹å¼ ( åˆå§‹å®¹é‡ * 0.75)")])])]),t._v(" "),a("li",[t._v("ä¸º-1, è¡¨ç¤ºæ•°ç»„æ­£åœ¨åˆå§‹åŒ–")]),t._v(" "),a("li",[t._v("å°äº0å¹¶ä¸”ä¸æ˜¯-1,è¡¨ç¤ºæ•°ç»„æ­£åœ¨æ‰©å®¹, -(1+n)å°±æ˜¯æ­£åœ¨è¿›è¡Œæ‰©å®¹çš„çº¿ç¨‹æ•°")])]),t._v(" "),a("h2",{attrs:{id:"ä»£ç é€»è¾‘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä»£ç é€»è¾‘"}},[t._v("#")]),t._v(" ä»£ç é€»è¾‘")]),t._v(" "),a("h3",{attrs:{id:"new"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#new"}},[t._v("#")]),t._v(" new")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConcurrentHashMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" initialCapacity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("initialCapacity "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IllegalArgumentException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç»™çš„åˆå§‹å®¹é‡ + åˆå§‹å®¹é‡/4+1")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" cap "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("initialCapacity "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MAXIMUM_CAPACITY "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("\n                   MAXIMUM_CAPACITY "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tableSizeFor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("initialCapacity "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("initialCapacity "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sizeCtl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("åˆ›å»ºæ—¶æŒ‡å®šåˆå§‹å®¹é‡,å†…éƒ¨ä¼šè¿›è¡Œè®¡ç®—. æœ€ç»ˆçš„å€¼ä¼šæ¯”ä¼ å…¥çš„å¤§,æœ€ç»ˆç®—å‡ºæ¥çš„æ ‘ç»å¯¹æ˜¯2å¹‚æ¬¡æ–¹")]),t._v(" "),a("p",[t._v("new çš„æ—¶å€™åªæ˜¯è®¡ç®—äº†ä¸€ä¸‹ siziclt, å¹¶æ²¡æœ‰å®é™…åˆå§‹åŒ–æ•°ç»„")]),t._v(" "),a("h3",{attrs:{id:"put"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#put"}},[t._v("#")]),t._v(" put")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// äºŒè¿›åˆ¶çš„å½¢å¼ 0 1111...11 æœ€é«˜ä½æ˜¯0(æ­£æ•°), é€šè¿‡è¿™ä¸ªæ‰°åŠ¨å‚æ•°,ç®—å‡ºæ¥çš„hashå€¼ä¸€å®šæ˜¯ä¸ªæ­£æ•°")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" HASH_BITS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x7fffffff")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("spread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" h"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" HASH_BITS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("putVal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" onlyIfAbsent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NullPointerException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" hash "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("spread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hashCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ­»å¾ªç¯")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" tab "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" table"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç¬¬ä¸€æ¬¡put,ä¼šè¿›è¡Œåˆå§‹åŒ–")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tab "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                tab "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initTable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tabAt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" hash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆå§‹åŒ–åç¬¬äºŒæ¬¡è¿›å…¥å¾ªç¯æ¥åˆ°è¿™ä¸ªæ–¹æ³•,")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ ¹æ®keyç®—å‡ºhashä¸‹æ ‡,ç„¶ååˆ¤æ–­è¿™ä¸ªä½ç½®æ˜¯ä¸æ˜¯ä¸ºç©º")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ²¡æœ‰å…ƒç´ å°±ç›´æ¥CASå¤åˆ¶,å°†nodeå­˜åˆ°tableä¸­")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n")])])]),a("ol",[a("li",[t._v("key å’Œ val éƒ½ä¸å…è®¸ä¸ºç©º")]),t._v(" "),a("li",[t._v("è®¡ç®—hashcodeçš„å€¼,ç®—å‡ºæ¥ä¸€å®šæ˜¯ä¸€ä¸ªæ­£æ•°.")]),t._v(" "),a("li",[a("code",[t._v("HASH_BITS")]),t._v(" æ‰°åŠ¨å‚æ•°ä½¿ç®—å‡ºæ¥ä¸€å®šæ˜¯æ­£æ•°")])]),t._v(" "),a("h3",{attrs:{id:"inittableæ–¹æ³•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#inittableæ–¹æ³•"}},[t._v("#")]),t._v(" initTableæ–¹æ³•")]),t._v(" "),a("p",[t._v("ç¬¬ä¸€æ¬¡putæ—¶ä¼šè¿›å…¥  initTableæ–¹æ³•\ninitTableæ˜¯ä¸€ä¸ªæ­»å¾ªç¯æ–¹æ³•")]),t._v(" "),a("ul",[a("li",[t._v("ç¬¬ä¸€æ­¥: åˆ¤æ–­sizeCtlæ˜¯å¦ç­‰äº0\n"),a("ul",[a("li",[t._v("ä¸ç­‰äº0è¯´æ˜æœ‰åˆ«çš„çº¿ç¨‹åœ¨è¿›è¡Œåˆå§‹åŒ–,ç›´æ¥çº¿ç¨‹ "),a("code",[t._v("Thread.yield()")]),t._v(" è®©å‡ºcpu")])])]),t._v(" "),a("li",[t._v("ç¬¬äºŒæ­¥:"),a("code",[t._v("sizeCtl==0")]),t._v(",ä½¿ç”¨ CASå°†sizeCtlæ”¹ä¸º-1, å¦‚æœCASæˆåŠŸåˆ™è¿›å…¥é€»è¾‘ "),a("code",[t._v("else if (U.compareAndSwapInt(this, SIZECTL, sc, -1))")]),t._v(" "),a("ul",[a("li",[t._v("å¦‚æœè®¾ç½®å¤±è´¥ åˆ™è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯")])])]),t._v(" "),a("li",[t._v("ç¬¬ä¸‰æ­¥: CASæˆåŠŸåå…ˆåˆ¤æ–­ tabæ˜¯å¦ä¸ºç©º,é•¿åº¦æ˜¯å¦ä¸º0 "),a("code",[t._v("if ((tab = table) == null || tab.length == 0)")]),t._v(" "),a("ul",[a("li",[t._v("å¦‚æœåˆ¤æ–­ä¸æ»¡è¶³,åˆ™è¯æ˜æ•°ç»„å·²ç»åˆå§‹åŒ–,ç›´æ¥"),a("code",[t._v("break")]),t._v("é€€å‡ºæ“ä½œ")])])]),t._v(" "),a("li",[t._v("ç¬¬å››æ­¥: æ‰§è¡Œåˆå§‹\n"),a("ul",[a("li",[t._v("åˆ›å»ºå±€éƒ¨æ•°ç»„å˜é‡,  æ ¹æ®scè¿›è¡Œåˆå§‹åŒ–æ•°ç»„é•¿åº¦,å¦‚æœæ²¡æŒ‡å®šå°±æ˜¯16")]),t._v(" "),a("li",[t._v("åˆ›å»ºå®Œæˆåå°†æ•°ç»„èµ‹å€¼ç»™å…¨å±€å˜é‡")])])]),t._v(" "),a("li",[t._v("ç¬¬äº”æ­¥: è®¡ç®—æ–°çš„SC\n"),a("ul",[a("li",[a("code",[t._v("n - (n >>> 2)")]),t._v(" ç®—å‡ºæ¥ç›¸å½“äº nå‡å››åˆ†ä¹‹ä¸€n = 3/4N ç›¸å½“äº n*0.75")]),t._v(" "),a("li",[a("code",[t._v("break")])])])])]),t._v(" "),a("h3",{attrs:{id:"putæ–¹æ³•è§£è¯»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#putæ–¹æ³•è§£è¯»"}},[t._v("#")]),t._v(" putæ–¹æ³•è§£è¯»")]),t._v(" "),a("p",[t._v("æ­»å¾ªç¯åˆ¤æ–­, ä½¿ç”¨CAS+è‡ªæ—‹çš„æ–¹å¼è¿›è¡Œput")]),t._v(" "),a("ol",[a("li",[t._v("å¦‚æœæ²¡æœ‰åˆå§‹åŒ–tableå°±è¿›è¡Œåˆå§‹åŒ–")]),t._v(" "),a("li",[t._v("åˆå§‹åŒ–å®Œæ¯•ä¹‹åå†æ¬¡è¿›å…¥å¾ªç¯,ç„¶åè®¡ç®—hash")]),t._v(" "),a("li",[t._v("æ ¹æ®ç®—å‡ºæ¥çš„hashåˆ¤æ–­ä½ç½®æ˜¯æ˜¯å¦ä¸ºç©º\n"),a("ol",[a("li",[t._v("ä¸ºç©ºç›´æ¥CASèµ‹å€¼,å¦‚æœcaså¤±è´¥è¿›å…¥å†æ¬¡å¾ªç¯")]),t._v(" "),a("li",[t._v("å¦‚æœç›®æ ‡ä½ç½®ä¸ºMOVEå€¼,è¯´æ˜è¿™ä¸ªæ•°ç»„æ­£åœ¨æ‰©å®¹ "),a("code",[t._v("MOVEDæ˜¯ä¸ªå¸¸é‡= -1")])])])]),t._v(" "),a("li",[t._v("å¦‚æœä¸‹æ ‡ä½ç½®æœ‰å…ƒç´ äº†, é‚£ä¹ˆåŠ syncé”ä¸»è¿™ä¸ªä½ç½®çš„å¯¹è±¡(åªé”å¯¹åº”æ¡¶ä½ç½®)")]),t._v(" "),a("li",[t._v("å¦‚æœåŠ syncé”æˆåŠŸ,å…ˆåˆ¤æ–­è¿™ä¸ªä½ç½®çš„å¯¹è±¡æ˜¯ä¸æ˜¯è¿˜æ˜¯åŸæ¥é‚£ä¸ªå¯¹è±¡(æœ‰å¯èƒ½å·²ç»æˆæ ‘äº†)")]),t._v(" "),a("li",[t._v("å…ˆåˆ¤æ–­hashå€¼æ˜¯å¦å¤§äº0,å¤§äº0=é“¾è¡¨ç»“æ„,å¦åˆ™æ ‘ç»“æ„\n"),a("ol",[a("li",[t._v("å¦‚æœæ˜¯é“¾è¡¨ç»“æ„å°±è¿›è¡Œ  è¿½åŠ æ“ä½œæˆ–è€…ä¿®æ”¹æ“ä½œ")]),t._v(" "),a("li",[t._v("å¦‚æœæ˜¯æ ‘å°±è¿›è¡Œæ ‘çš„æ“ä½œ")])])]),t._v(" "),a("li",[a("strong",[t._v("å…ƒç´ æ·»åŠ å®Œæˆä¹‹å")]),t._v(" åˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦ >=8\n"),a("ol",[a("li",[a("blockquote",[a("p",[t._v("=8è¿›å…¥è½¬æ¢æ ‘æ“ä½œ, å˜æ ‘æ“ä½œä¸­,å¦‚æœæ•°ç»„é•¿åº¦å°äº64 ä¸ä¼šè¿›è¡Œå˜æ ‘(èµ°æ‰©å®¹æœºåˆ¶)")])])])])]),t._v(" "),a("li",[t._v("ç»´æŠ¤é›†åˆé•¿åº¦")]),t._v(" "),a("li",[t._v("é›†åˆé•¿åº¦æ˜¯å¦è¾¾åˆ°é˜ˆå€¼,è¾¾åˆ°äº†å°±è¿›è¡Œæ‰©å®¹")])])])}),[],!1,null,null,null);s.default=e.exports}}]);